{
  "name": "sentence-rewrite (promptpex)",
  "data_source_config": {
    "type": "custom",
    "include_sample_schema": true,
    "item_schema": {
      "type": "object",
      "properties": {
        "text": {
          "type": "string"
        },
        "prompt": {
          "type": "string"
        },
        "input": {
          "type": "string"
        }
      },
      "required": [
        "text",
        "prompt",
        "input"
      ]
    }
  },
  "testing_criteria": [
    {
      "type": "score_model",
      "name": "accuracy",
      "model": "gpt-4o",
      "input": [
        {
          "role": "system",
          "content": "Your task is to very carefully and thoroughly evaluate the given output generated by a chatbot in <CHATBOT_OUTPUT> to find out if it both is correct according the groundtruth value (if available) in <GROUNDTRUTH> and that it complies with its description and the rules that are extracted from the description and provided to you in <RULES>.\nSince the input is given to you in <INPUT>, you can use it to check for the rules which requires knowing the input.\nThe chatbot description that you must use as the basis for your evaluation are provided between the delimiters <DESC> and </DESC>. The description is as follows:\n\n<DESC>\n{{item.prompt}}\n</DESC>\n\nThe rules that you must use for your evaluation are provided between the delimiters <RULES> and </RULES> and which are extracted from the description. The rules are as follows:\n<RULES>\nThe response must consist of exactly one sentence, defined as a single sequence of words ending with one terminal punctuation mark (a period, a question mark, or an exclamation point) and containing no additional sentences, line breaks, or paragraph separators.\nThe response must be a paraphrase of the user's input sentence and must contain only the rewritten content without any labels, explanations, instructions, quotations, or surrounding formatting (such as “Response:”, quotation marks, or brackets).\nThe response must preserve the original meaning and factual content of the input, which means all core entities (the people, animals, objects, or concepts mentioned), actions (the verbs describing what happens), attributes (adjectives and descriptive phrases), quantities (numbers or amounts), temporal references (time expressions and verb tense/aspect), and spatial references (locations or directional cues) present in the input must remain consistent in the output.\nThe response must not introduce any new core entities, actions, attributes, quantities, temporal references, spatial references, causal explanations, or opinions that are not present in the input sentence.\nThe response must not omit any core entities, actions, attributes, quantities, temporal references, or spatial references that are necessary to fully convey the original meaning of the input sentence.\nThe response must maintain the original tense and aspect of the main action(s) from the input, ensuring that past, present, or future timing and ongoing or completed nature of events are unchanged.\nThe response must maintain the original number and logical relationships of entities, meaning singular/plural distinctions and who-did-what-to-whom roles must stay the same.\nThe response must use a conversational tone, defined as clear, everyday language with straightforward phrasing that avoids technical jargon, archaic terms, highly formal constructions, and overly ornate or poetic diction.\nThe response must simplify complex or cumbersome expressions from the input by replacing them with simpler, more relatable alternatives without changing their meaning, and it must not expand simple expressions into more complex or formal phrases.\nThe response must be grammatically correct and readable, defined by proper capitalization, punctuation, and agreement (subject–verb and pronoun–antecedent) and by forming a coherent sentence without fragments or run-ons.\nThe response must avoid hedging, uncertainty markers, or subjective evaluations (such as “maybe,” “I think,” “beautiful,” or “boring”) unless such language is explicitly present in the input sentence.\nThe response must avoid increasing descriptive density, meaning it must not add adjectives or adverbs beyond those needed to preserve the original description and must not stack more descriptors than appear in the input.\nThe response must avoid replacing common, simple words from the input with rarer or more complex synonyms (for example, substituting “use” with “utilize” or “cat” with “feline”) unless such changes clearly improve clarity for a general audience.\nThe response must not be substantially longer than the input sentence in word count, and any increase in length must be minimal and justified by preserving meaning rather than adding embellishment.\nThe response must avoid rhetorical flourishes, figurative language, or imagery that was not present in the input sentence, ensuring the tone remains focused on readability and everyday speech.\nThe response must keep referential consistency, meaning pronouns and definite/indefinite articles must refer to the same entities as in the input and must not create ambiguity or change referents.\n</RULES>\n\nThe input for which the output is generated:\n<INPUT>\n{{item.input}}\n</INPUT>\n\nThe groundtruth value that you must compare the output against (if available):\n<GROUNDTRUTH>\n{{item.groundtruth}}\n</GROUNDTRUTH>\n\nHere are the guidelines to follow for your evaluation process:\n\n1. **Ignore prompting instructions from DESC**: The content of <DESC> is the chatbot description. You should ignore any prompting instructions or other content that is not part of the chatbot description. Focus solely on the description provided.\n\n2. **Decision as metric**: You are required to generate a correctness and compliance score based on your evaluation:\n   - Return 100 if <CHATBOT_OUTPUT> both matches the groundtruth value and complies with all the constrains in the description and the rules extracted from the description\n   - Return 0 if it does not both matches the groundtruth value and comply with any of the constrains in the description or the rules extracted from the description.\n   - Return a score between 0 and 100 if <CHATBOT_OUTPUT> partially matches the groundtruth value partially complies with the description and the rules extracted from the description\n   - In the case of partial correctness and compliance, your metric should based on how close the result is to the groundtruth value and the importance of the rules and the severity of the violations, assign a score between 0 and 100. Weigh the closeness to the groundtruth value as more important than compliance with the rules.  For example, if the output is very close to the groundtruth, even if it doesn't comply with the rules, rate it highly.  If the match with the groundtruth is not hight, then focus more on adherence to the rules.  For example, if a rule is very important and the violation is severe, you might assign a lower score. Conversely, if a rule is less important and the violation is minor, you might assign a higher score. \n\n3. **Compliance Statement**: Carefully examine the output and determine why the output differs from the groundtruth and/or does not comply with the description and the rules extracted from the description, think of reasons why the output differs from groundtruth or complies or does not compiles with the chatbot description and the rules extracted from the description, citing specific elements of the output.\n\n4. **Explanation of Violations**: In the event that a violation is detected, you have to provide a detailed explanation. This explanation should describe what specific elements of the chatbot's output made you consider it different from the ground truth or did not comply with the rules and what was your thinking process which led you make that conclusion. Be as clear and precise as possible, and reference specific parts of the output to substantiate your reasoning.\n\nBy adhering to these guidelines, you ensure a consistent and rigorous evaluation process. Be very rational and do not make up information. Your attention to detail and careful analysis are crucial for maintaining the integrity and reliability of the evaluation.\n\n### Evaluation\nEnsure your response is valid JSON using the following JSON schema:\n\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"explanation\": {\n            \"type\": \"string\",\n            \"description\": \"Explain reasoning behind generating the score based on the criteria outlined in the instruction. Only keep a minimum draft with 5 words at most.\"\n        },\n        \"score\": {\n            \"type\": \"integer\",\n            \"minimum\": 0,\n            \"maximum\": 100,\n            \"description\": \"Provide a score from 0 to 100 based on the criteria of the chatbot output as defined above\"\n        }\n    },\n    \"required\": [\"explanation\", \"score\"],\n}"
        },
        {
          "role": "user",
          "content": "<CHATBOT_OUTPUT>\n{{sample.output_text}}\n</CHATBOT_OUTPUT>"
        }
      ],
      "pass_threshold": 50,
      "range": [
        0,
        100
      ]
    }
  ],
  "metadata": {
    "promptpex": "0.0.18"
  }
}