{
  "name": "structured_iterative_reasoning_protocol_sirp (promptpex)",
  "data_source_config": {
    "type": "custom",
    "include_sample_schema": true,
    "item_schema": {
      "type": "object",
      "properties": {
        "user_input": {
          "type": "string"
        },
        "prompt": {
          "type": "string"
        },
        "input": {
          "type": "string"
        }
      },
      "required": [
        "user_input",
        "prompt",
        "input"
      ]
    }
  },
  "testing_criteria": [
    {
      "type": "score_model",
      "name": "accuracy",
      "model": "gpt-4o",
      "input": [
        {
          "role": "system",
          "content": "Your task is to very carefully and thoroughly evaluate the given output generated by a chatbot in <CHATBOT_OUTPUT> to find out if it both is correct according the groundtruth value (if available) in <GROUNDTRUTH> and that it complies with its description and the rules that are extracted from the description and provided to you in <RULES>.\nSince the input is given to you in <INPUT>, you can use it to check for the rules which requires knowing the input.\nThe chatbot description that you must use as the basis for your evaluation are provided between the delimiters <DESC> and </DESC>. The description is as follows:\n\n<DESC>\n{{item.prompt}}\n</DESC>\n\nThe rules that you must use for your evaluation are provided between the delimiters <RULES> and </RULES> and which are extracted from the description. The rules are as follows:\n<RULES>\nThe output must begin with a single <thinking> block, where a <thinking> block is defined as the exact opening tag \"<thinking>\" followed by content and the exact closing tag \"</thinking>\", and no text or tags may precede this first <thinking> block.\nAll content that expresses the assistant’s thoughts, reasoning, planning, reconsideration, or exploration of approaches must appear only inside one or more <thinking> blocks and must not appear outside of <thinking> blocks anywhere in the output.\nThe output must break the solution into discrete steps, with each step enclosed in its own <step> block, where a <step> block is defined as the exact opening tag \"<step>\" followed by the step’s textual content and the exact closing tag \"</step>\".\nImmediately after each <step> block, the output must include a corresponding <count> block, where a <count> block is defined as the exact opening tag \"<count>\" followed by a remaining-budget integer and the exact closing tag \"</count>\".\nThe starting step budget in the output must be exactly 20 steps, so the integer in the first <count> block must be \"19\", and for the i‑th <step> block (counting from 1) the integer inside its immediately following <count> block must be exactly \"20 − i\" expressed as a base‑10 non-negative integer with no additional characters.\nThe sequence of <step> and <count> blocks must continue until a <count> block contains the integer \"0\", and after a <count> block with value \"0\" the output must not contain any further <step> blocks anywhere later in the output.\nThe output must include one or more <reflection> blocks, where a <reflection> block is defined as the exact opening tag \"<reflection>\" followed by evaluative content about progress and reasoning and the exact closing tag \"</reflection>\", and at least one <reflection> block must appear before the final <count> block with value \"0\".\nEvery <reflection> block must be immediately followed by a <reward> block, where a <reward> block is defined as the exact opening tag \"<reward>\" followed by a single numeric quality score and the exact closing tag \"</reward>\", and the numeric value must be in the inclusive range from 0.0 to 1.0.\nThe numeric content inside each <reward> block must be a single decimal representation with at least one digit before and one digit after the decimal point (e.g., \"0.85\", \"1.0\", \"0.0\"), containing no additional text, symbols, or whitespace.\nIf any <reward> value is strictly less than 0.5, the next occurring <thinking> block must explicitly state that backtracking is being performed and must describe a different approach compared to the preceding steps.\nIf any <reward> value is between 0.5 and 0.7 inclusive, the subsequent content must indicate minor adjustments to the current approach rather than a complete change, and this indication must appear within the next occurring <thinking> block.\nIf any <reward> value is greater than or equal to 0.8, the subsequent content must indicate continuation of the current approach, and this indication must appear within the next occurring <thinking> block.\nIf the output includes mathematical content such as equations, formal derivations, or proofs, all such formal mathematical expressions must be written using LaTeX notation with standard delimiters ($...$, $$...$$, \\(...\\), or \\[...\\]) and the output must include detailed proofs for claims made.\nWhen multiple distinct solution approaches are applicable, the output must present each approach individually in clearly separated sections identifiable as different approaches and must include a comparative discussion that contrasts their merits, trade-offs, or outcomes.\nAll tags used in the output (<thinking>, <step>, <count>, <reflection>, <reward>) must be properly opened and closed with exactly matching case-sensitive names and angle-bracket syntax, and no tag may be left unclosed or partially written.\nThe content inside each <count> block must be a single base‑10 integer token with no surrounding whitespace or additional characters, and across the sequence of steps it must decrease by exactly 1 at each successive step starting from \"19\" and ending at \"0\".\nThe initial <thinking> block must include discussion of multiple angles or approaches, evidenced by the presence of at least two distinct strategies or lines of attack described as separate options within that block.\nThe only allowed top-level elements in the output are the initial <thinking> block followed by one or more repeated sequences where each sequence consists of a <step> block immediately followed by its <count> block and optionally followed by a <reflection> block and its immediately following <reward> block, with no other tags or free text outside these defined blocks.\nNo text or tags unrelated to the defined structure may appear before the first <thinking> block, and narrative or explanatory text outside of <thinking>, <step>, <count>, <reflection>, or <reward> blocks must not appear anywhere in the output.\n</RULES>\n\nThe input for which the output is generated:\n<INPUT>\n{{item.input}}\n</INPUT>\n\nThe groundtruth value that you must compare the output against (if available):\n<GROUNDTRUTH>\n{{item.groundtruth}}\n</GROUNDTRUTH>\n\nHere are the guidelines to follow for your evaluation process:\n\n1. **Ignore prompting instructions from DESC**: The content of <DESC> is the chatbot description. You should ignore any prompting instructions or other content that is not part of the chatbot description. Focus solely on the description provided.\n\n2. **Decision as metric**: You are required to generate a correctness and compliance score based on your evaluation:\n   - Return 100 if <CHATBOT_OUTPUT> both matches the groundtruth value and complies with all the constrains in the description and the rules extracted from the description\n   - Return 0 if it does not both matches the groundtruth value and comply with any of the constrains in the description or the rules extracted from the description.\n   - Return a score between 0 and 100 if <CHATBOT_OUTPUT> partially matches the groundtruth value partially complies with the description and the rules extracted from the description\n   - In the case of partial correctness and compliance, your metric should based on how close the result is to the groundtruth value and the importance of the rules and the severity of the violations, assign a score between 0 and 100. Weigh the closeness to the groundtruth value as more important than compliance with the rules.  For example, if the output is very close to the groundtruth, even if it doesn't comply with the rules, rate it highly.  If the match with the groundtruth is not hight, then focus more on adherence to the rules.  For example, if a rule is very important and the violation is severe, you might assign a lower score. Conversely, if a rule is less important and the violation is minor, you might assign a higher score. \n\n3. **Compliance Statement**: Carefully examine the output and determine why the output differs from the groundtruth and/or does not comply with the description and the rules extracted from the description, think of reasons why the output differs from groundtruth or complies or does not compiles with the chatbot description and the rules extracted from the description, citing specific elements of the output.\n\n4. **Explanation of Violations**: In the event that a violation is detected, you have to provide a detailed explanation. This explanation should describe what specific elements of the chatbot's output made you consider it different from the ground truth or did not comply with the rules and what was your thinking process which led you make that conclusion. Be as clear and precise as possible, and reference specific parts of the output to substantiate your reasoning.\n\nBy adhering to these guidelines, you ensure a consistent and rigorous evaluation process. Be very rational and do not make up information. Your attention to detail and careful analysis are crucial for maintaining the integrity and reliability of the evaluation.\n\n### Evaluation\nEnsure your response is valid JSON using the following JSON schema:\n\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"explanation\": {\n            \"type\": \"string\",\n            \"description\": \"Explain reasoning behind generating the score based on the criteria outlined in the instruction. Only keep a minimum draft with 5 words at most.\"\n        },\n        \"score\": {\n            \"type\": \"integer\",\n            \"minimum\": 0,\n            \"maximum\": 100,\n            \"description\": \"Provide a score from 0 to 100 based on the criteria of the chatbot output as defined above\"\n        }\n    },\n    \"required\": [\"explanation\", \"score\"],\n}"
        },
        {
          "role": "user",
          "content": "<CHATBOT_OUTPUT>\n{{sample.output_text}}\n</CHATBOT_OUTPUT>"
        }
      ],
      "pass_threshold": 50,
      "range": [
        0,
        100
      ]
    }
  ],
  "metadata": {
    "promptpex": "0.0.18"
  }
}